<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.w3.org/1999/xhtml"
      layout:decorator="layouts/default">
<head lang="en" th:replace="~{fragments/header :: header }"> </head>
<body>
<header id="topnav">
    <div class="navbar-overlay bg-animate"></div>
    <div th:replace="~{fragments/topnavbar :: top-navbar }"></div>
    <div th:replace="~{fragments/navbar :: navbar }"></div>
</header>
<div id="status">
    <div class="spinner"></div>
</div>
<div class="wrapper">
    <div class="container-fluid">
        <div class="row">
            <div class="col-12">
                <div class="page-title-box">
                    <div class="page-title-right">
                        <div class="btn-group"><button type="button" onClick="navigate('user');" class="btn btn-sm btn-info waves-effect waves-light">Add User</button><span class="gap"></span><button onClick="clearFilters();" type="button" class="btn btn-warning waves-effect waves-light btn-sm btn-fixed-sm" id="clearFilters">
                            <i class="mdi mdi-filter-remove"></i>
                        </button>
                            <button onClick="refreshTable();" type="button" class="btn btn-pink waves-effect waves-light btn-sm btn-fixed-sm">
                                <i class="mdi mdi-refresh"></i>
                            </button><button type="button" class="btn btn-sm btn-dark waves-effect waves-light dropdown-toggle btn-fixed-sm" data-toggle="dropdown" aria-expanded="false"><i class="fas fa-caret-down"></i></button>
                            <div class="dropdown-menu"><a class="dropdown-item" href="javascript: void(0);" onClick="navigate('groups');">Groups</a><a class="dropdown-item" href="javascript: void(0);" onClick="navigate('packages');">Packages</a><a class="dropdown-item" href="javascript: void(0);" onClick="navigate('subresellers');">Subresellers</a><a class="dropdown-item" href="javascript: void(0);" onClick="navigate('client_logs');">Client Logs</a><a class="dropdown-item" href="javascript: void(0);" onClick="navigate('credit_logs');">Credit Logs</a><a class="dropdown-item" href="javascript: void(0);" onClick="navigate('user_logs');">Reseller Logs</a><a class="dropdown-item" href="javascript: void(0);" onClick="navigate('mass_delete');">Mass Delete</a><a class="dropdown-item" href="javascript: void(0);" onClick="navigate('user_mass');">Mass Edit</a><a class="dropdown-item" href="javascript: void(0);" onClick="navigate('quick_tools');">Quick Tools</a><a class="dropdown-item" href="javascript: void(0);" id="btn-export-csv">Export as CSV</a></div></div>					</div>
                    <h4 class="page-title">Users</h4>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-body" style="overflow-x:auto;">
                        <div id="collapse_filters" class=" form-group row mb-4">
                            <div class="col-md-3">
                                <input type="text" class="form-control" id="reg_search" value="" placeholder="Search Users...">
                            </div>
                            <label class="col-md-2 col-form-label text-center" for="reg_reseller">Filter Results &nbsp; <button type="button" class="btn btn-light waves-effect waves-light btn-xs" onClick="clearOwner();"><i class="mdi mdi-close"></i></button></label>
                            <div class="col-md-3">
                                <select id="reg_reseller" class="form-control" data-toggle="select2">
                                </select>
                            </div>
                            <div class="col-md-2">
                                <select id="reg_filter" class="form-control" data-toggle="select2">
                                    <option value="" selected>No Filter</option>
                                    <option value="-1">Active</option>
                                    <option value="-2">Disabled</option>
                                    <option value="1">Administrators</option>
                                    <option value="2">Resellers</option>
                                </select>
                            </div>
                            <label class="col-md-1 col-form-label text-center" for="reg_show_entries">Show</label>
                            <div class="col-md-1">
                                <select id="reg_show_entries" class="form-control" data-toggle="select2">
                                    <option value="10">10</option>
                                    <option value="25">25</option>
                                    <option selected value="50">50</option>
                                    <option value="250">250</option>
                                    <option value="500">500</option>
                                    <option value="1000">1000</option>
                                </select>
                            </div>
                        </div>
                        <table id="datatable-users" class="table table-striped table-borderless dt-responsive nowrap font-normal">
                            <thead>
                            <tr>
                                <th class="text-center">ID</th>
                                <th>Username</th>
                                <th>Owner</th>
                                <th class="text-center">IP</th>
                                <th class="text-center">Status</th>
                                <th class="text-center">Type</th>
                                <th class="text-center">Credits</th>
                                <th class="text-center">Users</th>
                                <th class="text-center">Lines</th>
                                <th class="text-center">MAGs</th>
                                <th class="text-center">Enigmas</th>
                                <th class="text-center">Last Login</th>
                                <th class="text-center">Actions</th>
                            </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="modal fade bs-streams-modal-center" tabindex="-1" role="dialog" aria-labelledby="streamViewLabel" aria-hidden="true" style="display: none;" data-id="">
    <div class="modal-dialog modal-dialog-centered modal-xl">
        <div class="modal-content">
            <div class="modal-body">
                <table id="datatable-sources" class="table table-striped table-borderless mb-0" style="width:100%;">
                    <thead>
                    <tr>
                        <th>ID</th>
                        <th></th>
                        <th>Name</th>
                        <th>Server</th>
                        <th>Clients</th>
                        <th>Uptime</th>
                        <th>Actions</th>
                        <th>Actions</th>
                        <th>Stream Info</th>
                        <th>Stream Info</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
<div class="modal fade bs-epg-modal-center" tabindex="-1" role="dialog" aria-labelledby="epgViewLabel" aria-hidden="true" style="display: none;" data-id="">
    <div class="modal-dialog modal-dialog-centered modal-xl">
        <div class="modal-content">
            <div class="modal-body">
                <table id="datatable-epg" class="table table-striped table-borderless dt-responsive">
                    <thead>
                    <tr>
                        <th class="text-center">Time</th>
                        <th>Title</th>
                        <th>Description</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td></td><td></td><td></td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
<div class="modal fade bs-live-modal-center" tabindex="-1" role="dialog" aria-labelledby="liveViewLabel" aria-hidden="true" style="display: none;" data-id="">
    <div class="modal-dialog modal-dialog-centered modal-xl">
        <div class="modal-content">
            <div class="modal-body">
                <table id="datatable-live" class="table table-striped table-borderless mb-0" style="width:100%;">
                    <thead>
                    <tr>
                        <th class="text-center">ID</th>
                        <th class="text-center">Quality</th>
                        <th>Line</th>
                        <th>Stream</th>
                        <th>Server</th>
                        <th>Player</th>
                        <th>ISP</th>
                        <th class="text-center">IP</th>
                        <th class="text-center">Duration</th>
                        <th class="text-center">Output</th>
                        <th class="text-center">Restreamer</th>
                        <th class="text-center">Actions</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
<div class="modal fade bs-whois-modal-center" tabindex="-1" role="dialog" aria-labelledby="whoisLabel" aria-hidden="true" style="display: none;">
    <div class="modal-dialog modal-dialog-centered modal-md">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="whoisLabel"></h4>
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
            </div>
            <div class="modal-body">
                <table class="table mb-0" id="whois-table">
                    <tbody>
                    <tr>
                        <th scope="row" class="bg-secondary text-center text-white" colspan="2">GEOLOCATION</th>
                    </tr>
                    <tr>
                        <th scope="row">Continent</th>
                        <td></td>
                    </tr>
                    <tr>
                        <th scope="row">Country</th>
                        <td></td>
                    </tr>
                    <tr>
                        <th scope="row">City</th>
                        <td></td>
                    </tr>
                    <tr>
                        <th scope="row">Postcode</th>
                        <td></td>
                    </tr>
                    <tr>
                        <th scope="row">Lat Lng</th>
                        <td></td>
                    </tr>
                    <tr>
                        <th scope="row" class="bg-secondary text-center text-white" colspan="2">ISP</th>
                    </tr>
                    <tr>
                        <th scope="row">ISP Name</th>
                        <td></td>
                    </tr>
                    <tr>
                        <th scope="row">Organisation</th>
                        <td></td>
                    </tr>
                    <tr>
                        <th scope="row">AS Number</th>
                        <td></td>
                    </tr>
                    <tr>
                        <th scope="row">Type</th>
                        <td></td>
                    </tr>
                    <tr>
                        <th scope="row" class="bg-secondary text-center text-white" colspan="2">LOCALE</th>
                    </tr>
                    <tr>
                        <th scope="row">Timezone</th>
                        <td></td>
                    </tr>
                    <tr>
                        <th scope="row">Local Time</th>
                        <td></td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
<div class="modal fade bs-logs-modal-center" tabindex="-1" role="dialog" aria-labelledby="clearLogsLabel" aria-hidden="true" style="display: none;" data-id="">
    <div class="modal-dialog modal-dialog-centered modal-md">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="clearLogsLabel">Clear Logs</h4>
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
            </div>
            <div class="modal-body">
                <div class="form-group row mb-4">
                    <label class="col-md-4 col-form-label" for="range_clear">Date Range</label>
                    <div class="col-md-4">
                        <input type="text" class="form-control text-center date" id="range_clear_from" name="range_clear_from" data-toggle="date-picker" data-single-date-picker="true" autocomplete="off" placeholder="From">
                    </div>
                    <div class="col-md-4">
                        <input type="text" class="form-control text-center date" id="range_clear_to" name="range_clear_to" data-toggle="date-picker" data-single-date-picker="true" autocomplete="off" placeholder="To">
                    </div>
                </div>
                <div class="text-center">
                    <input id="clear_logs" type="submit" class="btn btn-primary" value="Clear" style="width:100%" />
                </div>
            </div>
        </div>
    </div>
</div>
<div class="modal fade addModal" role="dialog" aria-labelledby="addLabel" aria-hidden="true" style="display: none;" data-username="" data-password="">
    <div class="modal-dialog modal-dialog-centered modal-md">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="addModal">Select Series:</h4>
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
            </div>
            <div class="modal-body">
                <div class="col-12">
                    <select id="add_series_id" class="form-control" data-toggle="select2"></select>
                </div>
                <div class="col-12 add-margin-top-20">
                    <div class="input-group">
                        <div class="input-group-append" style="width:100%">
                            <button style="width:50%" class="btn btn-success waves-effect waves-light" type="button" onClick="addEpisode();"><i class="mdi mdi-plus-circle-outline"></i> Add Episode</button>
                            <button style="width:50%" class="btn btn-info waves-effect waves-light" type="button" onClick="addEpisodes();"><i class="mdi mdi-plus-circle-multiple-outline"></i> Multiple Episodes</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="modal fade downloadModal" role="dialog" aria-labelledby="downloadLabel" aria-hidden="true" style="display: none;" data-username="" data-password="">
    <div class="modal-dialog modal-dialog-centered modal-md">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="downloadModal">Download Playlist</h4>
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
            </div>
            <div class="modal-body">
                <div class="form-group row">
                    <label class="col-md-4 col-form-label" for="download_type">Format</label>
                    <div class="col-8">
                        <select id="download_type" class="form-control" data-toggle="select2">
                            <optgroup label="M3U Standard"><option value="m3u?output=hls">M3U Standard - HLS </option><option value="m3u">M3U Standard - MPEGTS</option><option value="m3u?output=rtmp">M3U Standard - RTMP</option></optgroup><optgroup label="M3U Plus"><option value="m3u_plus?output=hls">M3U Plus - HLS </option><option value="m3u_plus">M3U Plus - MPEGTS</option><option value="m3u_plus?output=rtmp">M3U Plus - RTMP</option></optgroup><optgroup label="Simple List"><option value="simple?output=hls">Simple List - HLS </option><option value="simple">Simple List - MPEGTS</option><option value="simple?output=rtmp">Simple List - RTMP</option></optgroup><optgroup label="Ariva"><option value="ariva?output=hls">Ariva - HLS </option><option value="ariva">Ariva - MPEGTS</option><option value="ariva?output=rtmp">Ariva - RTMP</option></optgroup><optgroup label="DreamBox OE 2.0"><option value="dreambox?output=hls">DreamBox OE 2.0 - HLS </option><option value="dreambox">DreamBox OE 2.0 - MPEGTS</option><option value="dreambox?output=rtmp">DreamBox OE 2.0 - RTMP</option></optgroup><optgroup label="Enigma 2 OE 1.6"><option value="enigma16?output=hls">Enigma 2 OE 1.6 - HLS </option><option value="enigma16">Enigma 2 OE 1.6 - MPEGTS</option><option value="enigma16?output=rtmp">Enigma 2 OE 1.6 - RTMP</option></optgroup><optgroup label="Enigma 2 OE 1.6 Auto Script"><option data-text="wget -O /etc/enigma2/iptv.sh {DEVICE_LINK} && chmod 777 /etc/enigma2/iptv.sh && /etc/enigma2/iptv.sh" value="enigma216_script?output=hls">Enigma 2 OE 1.6 Auto Script - HLS </option><option data-text="wget -O /etc/enigma2/iptv.sh {DEVICE_LINK} && chmod 777 /etc/enigma2/iptv.sh && /etc/enigma2/iptv.sh" value="enigma216_script">Enigma 2 OE 1.6 Auto Script - MPEGTS</option><option data-text="wget -O /etc/enigma2/iptv.sh {DEVICE_LINK} && chmod 777 /etc/enigma2/iptv.sh && /etc/enigma2/iptv.sh" value="enigma216_script?output=rtmp">Enigma 2 OE 1.6 Auto Script - RTMP</option></optgroup><optgroup label="Enigma 2 OE 2.0 Auto Script"><option data-text="wget -O /etc/enigma2/iptv.sh {DEVICE_LINK} && chmod 777 /etc/enigma2/iptv.sh && /etc/enigma2/iptv.sh" value="enigma22_script?output=hls">Enigma 2 OE 2.0 Auto Script - HLS </option><option data-text="wget -O /etc/enigma2/iptv.sh {DEVICE_LINK} && chmod 777 /etc/enigma2/iptv.sh && /etc/enigma2/iptv.sh" value="enigma22_script">Enigma 2 OE 2.0 Auto Script - MPEGTS</option><option data-text="wget -O /etc/enigma2/iptv.sh {DEVICE_LINK} && chmod 777 /etc/enigma2/iptv.sh && /etc/enigma2/iptv.sh" value="enigma22_script?output=rtmp">Enigma 2 OE 2.0 Auto Script - RTMP</option></optgroup><optgroup label="Fortec999/Prifix9400/Starport"><option value="fps?output=hls">Fortec999/Prifix9400/Starport - HLS </option><option value="fps">Fortec999/Prifix9400/Starport - MPEGTS</option><option value="fps?output=rtmp">Fortec999/Prifix9400/Starport - RTMP</option></optgroup><optgroup label="Geant/Starsat/Tiger/Qmax/Hyper/Royal"><option value="gst?output=hls">Geant/Starsat/Tiger/Qmax/Hyper/Royal - HLS </option><option value="gst">Geant/Starsat/Tiger/Qmax/Hyper/Royal - MPEGTS</option><option value="gst?output=rtmp">Geant/Starsat/Tiger/Qmax/Hyper/Royal - RTMP</option></optgroup><optgroup label="GigaBlue"><option value="gigablue?output=hls">GigaBlue - HLS </option><option value="gigablue">GigaBlue - MPEGTS</option><option value="gigablue?output=rtmp">GigaBlue - RTMP</option></optgroup><optgroup label="MediaStar / StarLive v4"><option value="mediastar?output=hls">MediaStar / StarLive v4 - HLS </option><option value="mediastar">MediaStar / StarLive v4 - MPEGTS</option><option value="mediastar?output=rtmp">MediaStar / StarLive v4 - RTMP</option></optgroup><optgroup label="Octagon"><option value="octagon?output=hls">Octagon - HLS </option><option value="octagon">Octagon - MPEGTS</option><option value="octagon?output=rtmp">Octagon - RTMP</option></optgroup><optgroup label="Octagon Auto Script"><option data-text="wget -qO /var/bin/iptv {DEVICE_LINK}" value="octagon_script?output=hls">Octagon Auto Script - HLS </option><option data-text="wget -qO /var/bin/iptv {DEVICE_LINK}" value="octagon_script">Octagon Auto Script - MPEGTS</option><option data-text="wget -qO /var/bin/iptv {DEVICE_LINK}" value="octagon_script?output=rtmp">Octagon Auto Script - RTMP</option></optgroup><optgroup label="Revolution 60/60 | Sunplus"><option value="revosun?output=hls">Revolution 60/60 | Sunplus - HLS </option><option value="revosun">Revolution 60/60 | Sunplus - MPEGTS</option><option value="revosun?output=rtmp">Revolution 60/60 | Sunplus - RTMP</option></optgroup><optgroup label="Spark"><option value="spark?output=hls">Spark - HLS </option><option value="spark">Spark - MPEGTS</option><option value="spark?output=rtmp">Spark - RTMP</option></optgroup><optgroup label="Starlive v3/StarSat HD6060/AZclass"><option value="starlivev3?output=hls">Starlive v3/StarSat HD6060/AZclass - HLS </option><option value="starlivev3">Starlive v3/StarSat HD6060/AZclass - MPEGTS</option><option value="starlivev3?output=rtmp">Starlive v3/StarSat HD6060/AZclass - RTMP</option></optgroup><optgroup label="StarLive v5"><option value="starlivev5?output=hls">StarLive v5 - HLS </option><option value="starlivev5">StarLive v5 - MPEGTS</option><option value="starlivev5?output=rtmp">StarLive v5 - RTMP</option></optgroup><optgroup label="WebTV List"><option value="webtvlist?output=hls">WebTV List - HLS </option><option value="webtvlist">WebTV List - MPEGTS</option><option value="webtvlist?output=rtmp">WebTV List - RTMP</option></optgroup><optgroup label="Zorro"><option value="zorro?output=hls">Zorro - HLS </option><option value="zorro">Zorro - MPEGTS</option><option value="zorro?output=rtmp">Zorro - RTMP</option></optgroup>                        </select>
                    </div>
                </div>
                <div class="form-group row">
                    <label class="col-md-4 col-form-label" for="output_type">Limit Output</label>
                    <div class="col-8">
                        <select id="output_type" class="form-control select2-multiple" data-toggle="select2" multiple="multiple" data-placeholder="Choose...">
                            <option value="live">Live Streams</option>
                            <option value="movie">Movies</option>
                            <option value="created_live">Created Channels</option>
                            <option value="radio_streams">Radio Stations</option>
                            <option value="series">TV Series</option>
                        </select>
                    </div>
                </div>
                <div class="form-group row">
                    <div class="col-12">
                        <div class="input-group">
                            <input type="text" class="form-control" id="download_url" value="">
                            <div class="input-group-append">
                                <button class="btn btn-warning waves-effect waves-light" type="button" onClick="copyDownload();"><i class="mdi mdi-content-copy"></i></button>
                                <button class="btn btn-info waves-effect waves-light" type="button" onClick="doDownload();" id="download_button" disabled><i class="mdi mdi-download"></i></button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="modal fade messageModal" role="dialog" aria-labelledby="messageModal" aria-hidden="true" style="display: none;" data-id="">
    <div class="modal-dialog modal-dialog-centered modal-md">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="messageModal">MAG Event</h4>
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
            </div>
            <div class="modal-body">
                <div class="col-12">
                    <select id="message_type" class="form-control" data-toggle="select2" >
                        <option value="" selected>Select an Event:</option>
                        <optgroup label="">
                            <option value="play_channel">Play Channel</option>
                            <option value="reload_portal">Reload Portal</option>
                            <option value="reboot">Reboot Device</option>
                            <option value="send_msg">Send Message</option>
                            <option value="cut_off">Close Portal</option>
                            <option value="reset_stb_lock">Reset STB Lock</option>
                        </optgroup>
                    </select>
                </div>
                <div class="col-12" style="margin-top:20px;display:none;" id="send_msg_form">
                    <div class="form-group row mb-4">
                        <div class="col-md-12">
                            <textarea id="message" name="message" class="form-control" rows="3" placeholder="Enter a custom message..."></textarea>
                        </div>
                    </div>
                    <div class="form-group row mb-4">
                        <label class="col-md-9 col-form-label" for="reboot_portal">Reboot Portal on Confirmation</label>
                        <div class="col-md-3">
                            <input name="reboot_portal" id="reboot_portal" type="checkbox" data-plugin="switchery" class="js-switch" data-color="#039cfd"/>
                        </div>
                    </div>
                </div>
                <div class="col-12" style="margin-top:20px;display:none;" id="play_channel_form">
                    <div class="form-group row mb-4">
                        <label class="col-md-3 col-form-label" for="selected_channel">Channel</label>
                        <div class="col-md-9">
                            <select id="selected_channel" name="selected_channel" class="form-control" data-toggle="select2" style="width:100%;"></select>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button disabled id="message_submit" type="button" class="btn btn-primary waves-effect">Send Event</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade bs-server-modal-center" tabindex="-1" role="dialog" aria-labelledby="restartServicesLabel" aria-hidden="true" style="display: none;" data-id="">
    <div class="modal-dialog modal-dialog-centered modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="restartServicesLabel">Server Tools</h4>
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
            </div>
            <div class="modal-body">
                <div class="form-group row">
                    <div class="col-md-3">
                        <input id="reinstall_server" type="submit" class="btn btn-light" value="Reinstall Server" style="width:100%"  />
                    </div>
                    <div class="col-md-2">
                        <input id="restart_services_ssh" type="submit" class="btn btn-light" value="Restart Services" style="width:100%" />
                    </div>
                    <div class="col-md-2">
                        <input id="reboot_server_ssh" type="submit" class="btn btn-light" value="Reboot Server" style="width:100%" />
                    </div>
                    <div class="col-md-2">
                        <input id="update_binaries" type="submit" class="btn btn-light" value="Update Binaries" style="width:100%"  />
                    </div>
                    <div class="col-md-3">
                        <input id="update_server" type="submit" class="btn btn-light" value="Update Server" style="width:100%"  />
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="modal fade bs-domains" tabindex="-1" role="dialog" aria-labelledby="modalLabel" aria-hidden="true" style="display: none;">
    <div class="modal-dialog modal-dialog-centered modal-md">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="modalLabel">Domain List</h4>
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
            </div>
            <div class="modal-body">
                <p class="sub-header">Ensure the following domains are entered in your reCAPTCHA V2 admin console, otherwise your resellers will be unable to login via their domain.</p>
                <div class="table-responsive">
                    <table class="table mb-0">
                        <thead>
                        <tr>
                            <th>Type / Reseller</th>
                            <th>Domain Name</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <td>Server IP</td>
                            <td>94.136.190.139</td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="modal fade bs-xuiepg-modal-center" tabindex="-1" role="dialog" aria-labelledby="epgBrowserLabel" aria-hidden="true" style="display: none;" data-id="">
    <div class="modal-dialog modal-dialog-scrollable modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="epgBrowserLabel">XUI EPG Browser</h4>
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
            </div>
            <div class="modal-body">
                <table id="datatable-epg-api" class="table table-striped table-borderless dt-responsive">
                    <thead>
                    <tr>
                        <th class="text-center">Icon</th>
                        <th class="text-center">Call Sign</th>
                        <th>Name</th>
                        <th class="text-center">Language</th>
                        <th class="text-center">Type</th>
                        <th class="text-center">Actions</th>
                    </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </div>
</div>
<div class="modal fade bs-provider-streams-modal-center" tabindex="-1" role="dialog" aria-labelledby="providerStreamsLabel" aria-hidden="true" style="display: none;" data-id="">
    <div class="modal-dialog modal-dialog-scrollable modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="providerStreamsLabel">Provider Streams</h4>
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
            </div>
            <div class="modal-body">
                <table id="datatable-provider-streams" class="table table-striped table-borderless dt-responsive">
                    <thead>
                    <tr>
                        <th class="text-center">Icon</th>
                        <th>Stream Name</th>
                        <th>Provider</th>
                        <th class="text-center">Actions</th>
                    </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </div>
</div>
<div class="modal fade bs-provider-movies-modal-center" tabindex="-1" role="dialog" aria-labelledby="providerMoviesLabel" aria-hidden="true" style="display: none;" data-id="">
    <div class="modal-dialog modal-dialog-scrollable modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="providerMoviesLabel">Provider Movies</h4>
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
            </div>
            <div class="modal-body">
                <table id="datatable-provider-movies" class="table table-striped table-borderless dt-responsive">
                    <thead>
                    <tr>
                        <th>Stream Name</th>
                        <th>Provider</th>
                        <th class="text-center">Actions</th>
                    </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </div>
</div>
<div class="modal fade bs-picon-modal-center" tabindex="-1" role="dialog" aria-labelledby="epgPiconLabel" aria-hidden="true" style="display: none;" data-id="">
    <div class="modal-dialog modal-dialog-center modal-md">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="epgPiconLabel">Use the EPG icon for this stream?</h4>
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
            </div>
            <div class="modal-body text-center">
                <img id="epg-picon" src="" class="img-thumbnail" style="max-width: 400px; max-height: 250px;"><br/><br/>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary waves-effect" data-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-success waves-effect waves-light" id="epg_picon_save">Use Icon</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade creditsModal" role="dialog" aria-labelledby="creditsLabel" aria-hidden="true" style="display: none;" data-id="">
    <div class="modal-dialog modal-dialog-centered modal-md">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="creditsModal">Add / Remove Credits</h4>
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
            </div>
            <div class="modal-body">
                <div class="form-group row">
                    <label class="col-md-8 col-form-label" for="credits">Credits</label>
                    <div class="col-md-4">
                        <input type="text" class="form-control text-center" id="credits" onkeypress="return isNumberKey(event)" name="credits" value="">
                    </div>
                </div>
                <div class="form-group row">
                    <div class="col-md-12">
                        <input type="text" class="form-control" id="credits_reason" name="credits_reason" placeholder="Reason for Adjustment..." value="">
                    </div>
                </div>
                <div class="form-group row">
                    <div class="col-md-12">
                        <button class="btn btn-info waves-effect waves-light" style="width:100%;" type="button" onClick="submitCredits();">Adjust Credits</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="modal fade bs-programme" tabindex="-1" role="dialog" aria-labelledby="programmeLabel" aria-hidden="true" style="display: none;">
    <div class="modal-dialog modal-dialog-centered modal-md">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title"><span id="programmeLabel"></span> &nnbsp;<small><span id="programmeStart"></span></small></h4>
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
            </div>
            <div class="modal-body">
                <p class="sub-header" id="programmeDescription"></p>
                <button type="button" id="programmeRecord" class="btn btn-danger waves-effect"><i class="mdi mdi-record"></i> Record</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade fingerprintModal" role="dialog" aria-labelledby="fingerprintLabel" aria-hidden="true" style="display: none;" data-id="" data-type="">
    <div class="modal-dialog modal-dialog-centered modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="fingerprintModal">Fingerprint</h4>
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
            </div>
            <div class="modal-body">
                <div class="form-group row">
                    <label class="col-md-1 col-2 col-form-label text-center" for="mod_fingerprint_type">Type</label>
                    <div class="col-md-2 col-6">
                        <select id="mod_fingerprint_type" class="form-control text-center" data-toggle="select2">
                            <option value="1">Activity ID</option>
                            <option value="2">Username</option>
                            <option value="3">Message</option>
                        </select>
                    </div>
                    <label class="col-md-1 col-2 col-form-label text-center" for="mod_font_size">Size</label>
                    <div class="col-md-1 col-2">
                        <input type="text" class="form-control text-center" id="mod_font_size" value="36" placeholder="">
                    </div>
                    <label class="col-md-1 col-2 col-form-label text-center" for="mod_font_color">Colour</label>
                    <div class="col-md-2 col-2">
                        <input type="text" id="mod_font_color" class="form-control text-center" value="#ffffff">
                    </div>
                    <label class="col-md-1 col-2 col-form-label text-center" for="mod_position_x">Pos</label>
                    <div class="col-md-1 col-2">
                        <input type="text" class="form-control text-center" id="mod_position_x" value="10" placeholder="X">
                    </div>
                    <div class="col-md-1 col-2">
                        <input type="text" class="form-control text-center" id="mod_position_y" value="10" placeholder="Y">
                    </div>
                    <div class="col-md-1 col-2">
                        <button type="button" class="btn btn-info waves-effect waves-light" onClick="setModalFingerprint()">
                            <i class="mdi mdi-fingerprint"></i>
                        </button>
                    </div>
                    <div class="col-md-12 col-2" style="margin-top:10px;display:none;" id="mod_custom_message_div">
                        <input type="text" class="form-control" id="mod_custom_message" value="" placeholder="Custom Message">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="modal fade bs-failures-modal-center" tabindex="-1" role="dialog" aria-labelledby="failuresLabel" aria-hidden="true" style="display: none;" data-id="">
    <div class="modal-dialog modal-dialog-centered modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="failuresLabel"><button onClick='clearLogs()' type='button' class='btn btn-secondary btn-xs waves-effect waves-light'>Clear Stream Logs</button></h4>
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
            </div>
            <div class="modal-body">
                <table id="datatable-stream" class="table table-striped table-borderless dt-responsive">
                    <thead>
                    <tr>
                        <th>Server Name</th>
                        <th class="text-center">Source</th>
                        <th class="text-center">Action</th>
                        <th class="text-center">Date</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td></td><td></td><td></td><td></td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
<div class="modal fade bs-proxies-modal-center" tabindex="-1" role="dialog" aria-labelledby="proxiesLabel" aria-hidden="true" style="display: none;" data-id="">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
            <div class="modal-body">
                <table id="datatable-sources" class="table table-striped table-borderless dt-responsive">
                    <thead>
                    <tr>
                        <th class="text-center">ID</th>
                        <th>Server Name</th>
                        <th class="text-center">Server IP</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td></td><td></td><td></td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>        <footer class="footer">
    <a href="#" class="scrollToTop" id="scrollToBottom"><button type="button" class="btn btn-info waves-effect waves-light"><i class="fas fa-caret-down"></i></button></a>
    <a href="#" class="scrollToTop" id="scrollToTop"><button type="button" class="btn btn-success waves-effect waves-light"><i class="fas fa-caret-up"></i></button></a>
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-12 copyright text-center">&copy; 2021 <img height='20px' style='padding-left: 10px; padding-right: 10px; margin-top: -2px;' class='whiteout' src='./assets/images/logo-topbar.png' /> v1.5.12</div>
        </div>
    </div>
</footer>
<script src="assets/js/vendor.min.js"></script>
<script src="assets/libs/jquery-toast/jquery.toast.min.js"></script>
<script src="assets/libs/jquery-nice-select/jquery.nice-select.min.js"></script>
<script src="assets/libs/switchery/switchery.min.js"></script>
<script src="assets/libs/select2/select2.min.js"></script>
<script src="assets/libs/nestable2/jquery.nestable.min.js"></script>
<script src="assets/libs/bootstrap-touchspin/jquery.bootstrap-touchspin.min.js"></script>
<script src="assets/libs/bootstrap-maxlength/bootstrap-maxlength.min.js"></script>
<script src="assets/libs/clockpicker/bootstrap-clockpicker.min.js"></script>
<script src="assets/libs/moment/moment.min.js"></script>
<script src="assets/libs/daterangepicker/daterangepicker.js"></script>
<script src="assets/libs/datatables/jquery.dataTables.min.js"></script>
<script src="assets/libs/datatables/dataTables.bootstrap4.js"></script>
<script src="assets/libs/datatables/dataTables.responsive.min.js"></script>
<script src="assets/libs/datatables/responsive.bootstrap4.min.js"></script>
<script src="assets/libs/datatables/dataTables.buttons.min.js"></script>
<script src="assets/libs/datatables/buttons.bootstrap4.min.js"></script>
<script src="assets/libs/datatables/buttons.html5.min.js"></script>
<script src="assets/libs/datatables/buttons.flash.min.js"></script>
<script src="assets/libs/datatables/buttons.print.min.js"></script>
<script src="assets/libs/datatables/dataTables.keyTable.min.js"></script>
<script src="assets/libs/datatables/dataTables.select.min.js"></script>
<script src="assets/libs/datatables/dataTables.rowReorder.js"></script>
<script src="assets/libs/twitter-bootstrap-wizard/jquery.bootstrap.wizard.min.js"></script>
<script src="assets/libs/treeview/jstree.min.js"></script>
<script src="assets/libs/quill/quill.min.js"></script>
<script src="assets/libs/magnific-popup/jquery.magnific-popup.min.js"></script>
<script src="assets/libs/jbox/jBox.all.min.js"></script>
<script src="assets/libs/jquery-knob/jquery.knob.min.js"></script>
<script src="assets/libs/apexcharts/apexcharts.min.js"></script>
<script src="assets/libs/jquery-number/jquery.number.js"></script>
<script src="assets/libs/jquery-vectormap/jquery-jvectormap-1.2.2.min.js"></script>
<script src="assets/libs/jquery-vectormap/jquery-jvectormap-world-mill-en.js"></script>
<script src="assets/libs/jquery-ui/jquery-ui.min.js"></script>
<script src="assets/libs/peity/jquery.peity.min.js"></script>
<script src="assets/libs/emodal/emodal.js"></script>
<script src="assets/libs/bootstrap-colorpicker/bootstrap-colorpicker.min.js"></script>
<script src="assets/libs/lazyload/lazyload.min.js"></script>
<script src="assets/libs/parsleyjs/parsley.min.js"></script>
<script src="assets/js/app.min.js"></script>
<script>
    var rCurrentPage = "users";
    var rReferer = null;
    var rErrors = ["STATUS_FAILURE","STATUS_SUCCESS","STATUS_SUCCESS_MULTI","STATUS_CODE_LENGTH","STATUS_NO_SOURCES","STATUS_DISABLED","STATUS_NOT_ADMIN","STATUS_INVALID_EMAIL","STATUS_INVALID_PASSWORD","STATUS_INVALID_IP","STATUS_INVALID_PLAYLIST","STATUS_INVALID_NAME","STATUS_INVALID_CAPTCHA","STATUS_INVALID_CODE","STATUS_INVALID_DATE","STATUS_INVALID_FILE","STATUS_INVALID_GROUP","STATUS_INVALID_DATA","STATUS_INVALID_DIR","STATUS_INVALID_MAC","STATUS_EXISTS_CODE","STATUS_EXISTS_NAME","STATUS_EXISTS_USERNAME","STATUS_EXISTS_MAC","STATUS_EXISTS_SOURCE","STATUS_EXISTS_IP","STATUS_EXISTS_DIR","STATUS_SUCCESS_REPLACE","STATUS_FLUSH","STATUS_TOO_MANY_RESULTS","STATUS_SPACE_ISSUE","STATUS_INVALID_USER","STATUS_CERTBOT","STATUS_CERTBOT_INVALID","STATUS_INVALID_INPUT","STATUS_NOT_RESELLER","STATUS_NO_TRIALS","STATUS_INSUFFICIENT_CREDITS","STATUS_INVALID_PACKAGE","STATUS_INVALID_TYPE","STATUS_INVALID_USERNAME","STATUS_INVALID_SUBRESELLER","STATUS_NO_DESCRIPTION","STATUS_NO_KEY","STATUS_EXISTS_HMAC","STATUS_CERTBOT_RUNNING","STATUS_RESERVED_CODE","STATUS_NO_TITLE","STATUS_NO_SOURCE"];
    function submitForm(rType, rData, rReferer=null) {
        $(".wrapper").fadeOut();
        $("#status").fadeIn();
        if (!rReferer) {
            rReferer = "";
        }
        $.ajax({
            type: "POST",
            url: "post.php?action=" + encodeURIComponent(rType) + "&referer=" + encodeURIComponent(rReferer),
            data: rData,
            processData: false,
            contentType: false,
            success: function(rReturn) {
                try {
                    var rJSON = $.parseJSON(rReturn);
                } catch (e) {
                    var rJSON = {"status": 0, "result": false};
                }
                callbackForm(rJSON);
            }
        });
    }
    function callbackForm(rData) {
        if (rData.location) {
            if (self !== top) {
                parent.closeEditModal();
                parent.showSuccess("Item has been saved.");
            } else if (rData.reload) {
                window.location.href = rData.location;
            } else {
                navigate(rData.location);
            }
        } else {
            $(".wrapper").fadeIn();
            $("#status").fadeOut();
            $(':input[type="submit"]').prop('disabled', false);

            if (window.rErrors[rData.status] == "STATUS_INVALID_INPUT") {
                showError("Required entry fields have not been populated. Please check the form.");
                return;
            }

            switch (window.rCurrentPage) {
                case "record":
                    switch (window.rErrors[rData.status]) {
                        case "STATUS_NO_TITLE":
                            showError("Please enter a title for the recorded event.");
                            break;

                        case "STATUS_NO_SOURCE":
                            showError("Please select a source server to record the event from.");
                            break;

                        case "STATUS_NO_DESTINATION":
                            showError("Please select a destination server to record the event to.");
                            break;

                        default:
                            showError("An error occured while processing your request.");
                            break;
                    }
                    break;

                case "quick_tools":
                    showSuccess("Quick tool was successfully executed.");
                    break;

                case "code":
                    switch (window.rErrors[rData.status]) {
                        case "STATUS_CODE_LENGTH":
                            showError("Your access code needs to be at least 8 characters long.");
                            break;

                        case "STATUS_INVALID_CODE":
                            showError("Please enter an access code.");
                            break;

                        case "STATUS_RESERVED_CODE":
                            showError("Sorry, this code is reserved for system functions.");
                            break;

                        case "STATUS_EXISTS_CODE":
                            showError("This access code already exists, please use another.");
                            break;

                        default:
                            showError("An error occured while processing your request.");
                            break;
                    }
                    break;

                case "hmac":
                    switch (window.rErrors[rData.status]) {
                        case "STATUS_NO_DESCRIPTION":
                            showError("Please enter a description.");
                            break;

                        case "STATUS_EXISTS_HMAC":
                            showError("This HMAC Key already exists, please use another.");
                            break;

                        case "STATUS_NO_KEY":
                            showError("Please generate a key.");
                            break;

                        default:
                            showError("An error occured while processing your request.");
                            break;
                    }
                    break;

                case "edit_profile":
                    switch (window.rErrors[rData.status]) {
                        case "STATUS_INVALID_EMAIL":
                            showError("Please enter a valid email address.");
                            break;

                        default:
                            showError("An error occured while processing your request.");
                            break;
                    }
                    break;

                case "ip":
                    switch (window.rErrors[rData.status]) {
                        case "STATUS_INVALID_IP":
                            showError("Please enter a valid IP address / CIDR.");
                            break;

                        default:
                            showError("An error occured while processing your request.");
                            break;
                    }
                    break;

                case "user":
                    switch (window.rErrors[rData.status]) {
                        case "STATUS_INVALID_GROUP":
                            showError("Please select a member group.");
                            break;

                        case "STATUS_EXISTS_USERNAME":
                            showError("The username you selected already exists. Please use another.");
                            break;

                        default:
                            showError("An error occured while processing your request.");
                            break;
                    }
                    break;

                case "provider":
                    switch (window.rErrors[rData.status]) {
                        case "STATUS_EXISTS_IP":
                            showError("This provider is already being tracked on the system.");
                            break;

                        default:
                            showError("An error occured while processing your request.");
                            break;
                    }
                    break;

                case "created_channel":
                    switch (window.rErrors[rData.status]) {
                        case "STATUS_NO_SOURCES":
                            showError("Please select at least one source for your channel.");
                            break;

                        default:
                            showError("An error occured while processing your request.");
                            break;
                    }
                    break;

                case "group":
                    switch (window.rErrors[rData.status]) {
                        case "STATUS_INVALID_NAME":
                            showError("This group name is already in use. Please use another.");
                            break;

                        default:
                            showError("An error occured while processing your request.");
                            break;
                    }
                    break;

                case "isp":
                    switch (window.rErrors[rData.status]) {
                        case "STATUS_INVALID_NAME":
                            showError("This ISP has already been blocked.");
                            break;

                        default:
                            showError("An error occured while processing your request.");
                            break;
                    }
                    break;

                case "package":
                    switch (window.rErrors[rData.status]) {
                        case "STATUS_INVALID_NAME":
                            showError("This package name is already in use. Please use another.");
                            break;

                        default:
                            showError("An error occured while processing your request.");
                            break;
                    }
                    break;

                case "mag":
                case "enigma":
                    switch (window.rErrors[rData.status]) {
                        case "STATUS_INVALID_DATE":
                            showError("Please enter a valid date.");
                            break;

                        case "STATUS_INVALID_USER":
                            showError("The paired user does not exist! Please unlink it.");
                            break;

                        case "STATUS_INVALID_MAC":
                            showError("Please enter a valid MAC address.");
                            break;

                        case "STATUS_EXISTS_MAC":
                            showError("The MAC address you entered is already in use.");
                            break;

                        default:
                            showError("An error occured while processing your request.");
                            break;
                    }
                    break;

                case "serie":
                    switch (window.rErrors[rData.status]) {
                        case "STATUS_EXISTS_CODE":
                            showError("This series already exists in your database.");
                            break;

                        case "STATUS_NO_SOURCES":
                            showError("No new episodes could be found in the playlist or folder.");
                            break;

                        default:
                            showError("An error occured while processing your request.");
                            break;
                    }
                    break;

                case "movie":
                    switch (window.rErrors[rData.status]) {
                        case "STATUS_EXISTS_NAME":
                            showError("This movie already exists in your database. Please use another name.");
                            break;

                        case "STATUS_NO_SOURCES":
                            showError("Please select at least one source for your movie.");
                            break;

                        default:
                            showError("An error occured while processing your request.");
                            break;
                    }
                    break;

                case "radio":
                    switch (window.rErrors[rData.status]) {
                        case "STATUS_EXISTS_SOURCE":
                            showError("This station source is already in your database. Please use another URL.");
                            break;

                        case "STATUS_NO_SOURCES":
                            showError("Please select at least one source for your station.");
                            break;

                        default:
                            showError("An error occured while processing your request.");
                            break;
                    }
                    break;

                case "server_install":
                case "proxy":
                case "server":
                case "rtmp_ip":
                    switch (window.rErrors[rData.status]) {
                        case "STATUS_INVALID_IP":
                            showError("Please enter a valid IP address / CIDR.");
                            break;

                        case "STATUS_EXISTS_IP":
                            showError("This IP address is already in the database. Please use another.");
                            break;

                        default:
                            showError("An error occured while processing your request.");
                            break;
                    }
                    break;

                case "stream":
                    switch (window.rErrors[rData.status]) {
                        case "STATUS_INVALID_FILE":
                            showError("Could not process M3U file, please use another.");
                            break;

                        case "STATUS_EXISTS_SOURCE":
                            showError("This stream source is already in your database. Please use another URL.");
                            break;

                        case "STATUS_NO_SOURCES":
                            showError("Please select at least one source for your stream.");
                            break;

                        default:
                            showError("An error occured while processing your request.");
                            break;
                    }
                    break;

                case "ticket":
                    switch (window.rErrors[rData.status]) {
                        case "STATUS_INVALID_DATA":
                            showError("Please ensure you enter both a title and message.");
                            break;

                        default:
                            showError("An error occured while processing your request.");
                            break;
                    }
                    break;

                case "watch_add":
                    switch (window.rErrors[rData.status]) {
                        case "STATUS_EXISTS_DIR":
                            showError("This directory is already being watched, please use another.");
                            break;

                        case "STATUS_INVALID_DIR":
                            showError("An invalid directory was entered, please use another.");
                            break;

                        default:
                            showError("An error occured while processing your request.");
                            break;
                    }
                    break;

                case "plex_add":
                    switch (window.rErrors[rData.status]) {
                        case "STATUS_EXISTS_DIR":
                            showError("This library is already being synced, please use another.");
                            break;

                        default:
                            showError("An error occured while processing your request.");
                            break;
                    }
                    break;

                case "line":
                    switch (window.rErrors[rData.status]) {
                        case "STATUS_INVALID_DATE":
                            showError("Please enter a valid date.");
                            break;

                        case "STATUS_EXISTS_USERNAME":
                            showError("The username you selected already exists. Please use another.");
                            break;

                        default:
                            showError("An error occured while processing your request.");
                            break;
                    }
                    break;

                default:
                    showError("An error occured while processing your request.");
                    break;
            }
        }
    }
</script>
<script>
    var rRealURL = undefined;
    var jBoxes = [];
    var rOptions = [];
    var rSwitches = [];
    var rRefresh = null;
    var rProcessing = false;
    var rSearchTop = 0;
    var rShiftHeld = false;

    window.XUI = window.XUI || {};
    window.XUI.Listings = window.XUI.Listings || {};

    function hideModal(rName, rDispose = false) {
        $(rName).modal("hide");
        if (rDispose) {
            $(rName).modal("dispose");
        }
        $(rName).css("display", "none");
    }
    function showError(rText) {
        $.toast({
            text: rText,
            icon: 'warning',
            loader: true,
            loaderBg: '#c62828',
            hideAfter: 8000
        })
    }
    function showSuccess(rText) {
        $.toast({
            text: rText,
            icon: 'success',
            loader: true,
            hideAfter: 5000
        })
    }
    function findRowByID(rTable, rColumn, rID) {
        for (rRow in rTable.rows()[0]) {
            if ($(rTable.row(rRow).data()[rColumn]).data("id") == rID) {
                return rRow;
            } else if ((rTable.row(rRow).data()[rColumn] == rID) || ($(rTable.row(rRow).data()[rColumn]).text() == rID)) {
                return rRow;
            }
        }
        return null;
    }
    function isValidDomain(domain) {
        var re = new RegExp(/^((?:(?:(?:\w[\.\-\+]?)*)\w)+)((?:(?:(?:\w[\.\-\+]?){0,62})\w)+)\.(\w{2,16})$/);
        return domain.match(re);
    }
    function isValidIP(rIP) {
        if (/^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/.test(rIP)) {
            return true;
        } else {
            return false;
        }
    }
    function isValidDate(dateString) {
        var regEx = /^\d{4}-\d{2}-\d{2}$/;
        if(!dateString.match(regEx)) return false;  // Invalid format
        var d = new Date(dateString);
        var dNum = d.getTime();
        if(!dNum && dNum !== 0) return false; // NaN value, Invalid date
        return d.toISOString().slice(0,10) === dateString;
    }
    function isNumberKey(evt) {
        var charCode = (evt.which) ? evt.which : evt.keyCode;
        if (charCode != 46 && charCode != 45 && charCode > 31 && (charCode < 48 || charCode > 57)) {
            return false;
        } else {
            return true;
        }
    }
    function pingSession() {
        $.getJSON("./session", function(data) {
            if (!data.result) {
                window.location.href = './login?referrer=' + encodeURIComponent(location.href.split("/").slice(-1)[0]);
            }
        });
        setTimeout(pingSession, 30000);
    }
    function modalFingerprint(rID, rType = "stream") {
        $(".quick_search").select2("close");
        $("#topnav-search").removeClass("active");
        refreshTooltips();
        $('#mod_fingerprint_type').select2();
        $("#mod_custom_message_div").hide();
        $("#mod_fingerprint_type").val(1); $("#mod_font_size").val(36); $("#mod_font_color").val("#ffffff"); $("#mod_position_x").val(10); $("#mod_position_y").val(10); $("#mod_custom_message").val("");
        $(".fingerprintModal").data("id", rID);
        $(".fingerprintModal").data("type", rType)
        $('.fingerprintModal').modal('show');
    }
    function setModalFingerprint() {
        rArray = {"id": $(".fingerprintModal").data("id"), "font_size": $("#mod_font_size").val(), "font_color": $("#mod_font_color").val(), "message": "", "type": $("#mod_fingerprint_type").val(), "xy_offset": ""};
        if ($(".fingerprintModal").data("type") == "user") {
            rArray["user"] = true;
        }
        if (rArray.type == 3) {
            rArray["message"] = $("#mod_custom_message").val();
        }
        if (($("#mod_position_x").val() >= 0) && ($("#mod_position_y").val() >= 0)) {
            rArray["xy_offset"] = $("#mod_position_x").val() + "x" + $("#mod_position_y").val();
        }
        if ((rArray["font_size"] > 0) && (rArray["font_color"]) && ((rArray["message"]) || (rArray["type"] != 3)) && (rArray["font_size"] > 0) && (rArray["xy_offset"])) {
            $.getJSON("./api?action=fingerprint&data=" + encodeURIComponent(JSON.stringify(rArray)), function(data) {
                if (data.result == true) {
                    $.toast("Fingerprint signal has been sent.");
                } else {
                    $.toast("An error occured while processing your request.");
                }
            });
        } else {
            $.toast("Invalid fingerprint configuration. Please check that all fields are correct and try again.");
        }
        $(".fingerprintModal").modal("hide");
    }
    function setSwitch(switchElement, checkedBool) {
        if((checkedBool && !switchElement.isChecked()) || (!checkedBool && switchElement.isChecked())) {
            switchElement.setPosition(true);
            switchElement.handleOnchange(true);
        }
    }
    function reloadMenu() {
        $(".navigation-menu a").each(function() {
            ($(this).removeClass("active"), $(this).parent().removeClass("active"), $(this).parent().parent().removeClass("in"), $(this).parent().parent().prev().removeClass("active"), $(this).parent().parent().parent().removeClass("active"), $(this).parent().parent().parent().parent().removeClass("in"), $(this).parent().parent().parent().parent().parent().removeClass("active"));
        });
        $(".navigation-menu a").each(function() {
            var rURL = window.location.href.split(/[?#]/)[0];
            if (this.href == rURL) {
                ($(this).addClass("active"), $(this).parent().addClass("active"), $(this).parent().parent().addClass("in"), $(this).parent().parent().prev().addClass("active"), $(this).parent().parent().parent().addClass("active"), $(this).parent().parent().parent().parent().addClass("in"), $(this).parent().parent().parent().parent().parent().addClass("active"));
            }
        });
        setTimeout(fadeRipple, 350);
    }
    function fadeRipple() {
        $(".waves-ripple").attr("style", "");
    }
    function resetKnobs() {
        $('[data-plugin="knob"]').each(function(t, i) {
            $(this).knob({
                'format' : function (value) {
                    return value + '%';
                }
            })
        });
        $('[data-plugin="peity-line"]').each(function(t, i) {
            $(this).peity("line", $(this).data());
        });
    }
    function killTimeouts() {
        var highestTimeoutId = setTimeout(";");
        for (var i = 0 ; i < highestTimeoutId ; i++) {
            clearTimeout(i);
        }
    }
    function deleteSwitches() {
        $(window.rSwitches).each(function() {
            $(this).destroy();
        });
        $(".switchery").remove();
    }
    function deleteSelect2() {
        $("select").each(function() {
            if ($(this).data('select2')) {
                $(this).select2('destroy');
            }
        });
    }
    function navigate(rURL, rNewTab = false) {
        if ((window.rCurrentPage) && (rURL == window.rCurrentPage + "#")) {
            return false;
        }
        if (rURL.split("#")[0].split("?")[0] == "epg_view") {
            window.location.href = rURL;
            window.location.reload();
            return;
        }
        if (window.rShiftHeld) {
            return;
        }
        if (rNewTab) {
            window.open(rURL, '_blank');
            return;
        }
        $(".wrapper").off().find("*").off();
        $(".modal").off().find("*").off();
        $(".submenu").hide();
        hideModal('.modal', true);
        $(".modal-backdrop").hide();
        $(".wrapper").fadeOut();
        $(".jBox-wrapper").hide();
        $(window.jBoxes).each(function() {
            this.close();
        });
        window.rReferer = window.location.href.split("/").reverse()[0];
        window.rCurrentPage = rURL.split("/").reverse()[0].split("?")[0].split(".")[0];
        setURL(rURL, false);
        killTimeouts();
        clearTimeout(window.rRefresh);
        deleteSwitches();
        deleteSelect2();
        reloadMenu();
        $.magnificPopup.close();
        $("#status").fadeIn();
        $(".jq-toast-single").remove();
        $('html, body').animate({scrollTop : 0},400);
        $("#header_stats").show();
        $(".app-search").width(150);
        $("#topnav-search").removeClass("active");
        $(".multiselect").hide();
        $.get(rURL, function(rData) {
            if ($(rData).filter("title").data("id") == "login") {
                window.location.href = './login?referrer=' + encodeURIComponent(location.href.split("/").slice(-1)[0]);
            }
            var rTables = $.fn.dataTable.fnTables(true);
            $(rTables).each(function () {
                $(this).DataTable().destroy(true);
            });
            document.title = $(rData).filter("title").text();
            $(".wrapper").replaceWith($(rData).filter(".wrapper"));
            $("#scripts").replaceWith($(rData).filter("#scripts"));
            $("#topnav-custom").replaceWith($(rData).filter("#topnav").find("#topnav-custom"));
            jQuery.ready();
            resetKnobs();
            bindHref();
            refreshTooltips();
            if ($(".nav")) {
                $(".nav:first").find(".nav-link:first").trigger("click");
            }
            $(".wrapper").fadeIn();
            $("#status").fadeOut();
            $(':input[type="submit"]').prop('disabled', false);
        }).fail(function() {
            window.location.href = rURL;
        });
    }
    function reloadPage() {
        navigate(window.location.href);
    }
    function refreshTooltips(rModals = true) {
        if (rModals) {
            $(".jBox-wrapper").hide();
        }
        $(window.jBoxes).each(function() {
            this.close();
            this.destroy();
        });
        window.jBoxes = [];
        $('.tooltip-left').each(function() {
            window.jBoxes.push(new $(this).jBox('Tooltip', {theme: 'TooltipDark', position: {x: 'left', y: 'center'}, outside: 'x'}));
        });
        $('.tooltip-right').each(function() {
            window.jBoxes.push(new $(this).jBox('Tooltip', {theme: 'TooltipDark', position: {x: 'right', y: 'center'}, outside: 'x'}));
        });
        $('.tooltip').each(function() {
            window.jBoxes.push(new $(this).jBox('Tooltip', {theme: 'TooltipDark'}));
        });
    }
    function setURL(rURL, rReplace=true) {
        if (rReplace) {
            window.history.replaceState({}, '', rURL);
        } else {
            if (window.location.href.split("/").reverse()[0].split("?")[0].split(".")[0] != rURL.split("/").reverse()[0].split("?")[0].split(".")[0]) {
                window.history.pushState({}, '', rURL);
            }
            window.rRealURL = rURL;
        }
    }
    function delParams(rParams) {
        $.each(rParams, function(rIndex, rParam) {
            delParam(rParam);
        });
    }
    function delParam(rParam) {
        var rURL = new URL(document.location);
        rURL.searchParams.delete(rParam);
        setURL(rURL);
    }
    function setParam(rParam, rValue) {
        var rURL = new URL(document.location);
        rURL.searchParams.set(rParam, rValue);
        setURL(rURL);
    }
    function getParam(rParam) {
        var rURL = new URL(document.location);
        return rURL.searchParams.get(rParam);
    }
    function hasParam(rParam) {
        var rURL = new URL(document.location);
        return rURL.searchParams.has(rParam);
    }
    function hasParams(rParams, rAll=false) {
        var rURL = new URL(document.location);
        var rCount = 0;
        $.each(rParams, function(rIndex, rParam) {
            if (rURL.searchParams.has(rParam)) {
                rCount += 1;
            }
        });
        if (((rCount > 0) && (!rAll)) || (rCount == rParams.length)) {
            return true;
        } else {
            return false;
        }
    }
    function bindHref() {
        $("a").each(function() {
            if (($(this).attr("href")) && ($(this).data("modal") === undefined) && ($(this).attr("href").slice(0,1) != "#") && ($(this).attr("href").slice(0,11) != "javascript:") && ($(this).attr("href").slice(0,8) != "epg_view")) {
                $(this).unbind("click");
                $(this).click(function(e) {
                    navigate($(this).attr("href"), e.ctrlKey);
                    e.preventDefault();
                });
            }
        });
    }
    function whois(rIP) {
        $("#whoisLabel").html(rIP);
        var rRows = $("#whois-table tr");
        $(rRows).each(function() {
            $(this).find("td").html("");
        });
        $.getJSON("./api?action=ip_whois&isp=1&ip=" + encodeURIComponent(rIP), function(rData) {
            if ("data" in rData) {
                if (("continent" in rData.data) && ("names" in rData.data.continent) && ("en" in rData.data.continent.names)) {
                    $(rRows[1]).find("td").html(rData.data.continent.names.en);
                }
                if (("country" in rData.data) && ("names" in rData.data.country) && ("en" in rData.data.country.names)) {
                    $(rRows[2]).find("td").html(rData.data.country.names.en);
                }
                if (("city" in rData.data) && ("names" in rData.data.city) && ("en" in rData.data.city.names)) {
                    $(rRows[3]).find("td").html(rData.data.city.names.en);
                }
                if (("postal" in rData.data) && ("code" in rData.data.postal)) {
                    $(rRows[4]).find("td").html(rData.data.postal.code);
                }
                if (("location" in rData.data) && ("latitude" in rData.data.location) && ("longitude" in rData.data.location)) {
                    $(rRows[5]).find("td").html(rData.data.location.latitude + ", " + rData.data.location.longitude);
                }
                if (("isp" in rData.data) && (rData.data.isp)) {
                    if ("isp" in rData.data.isp) {
                        $(rRows[7]).find("td").html(rData.data.isp.isp);
                    }
                    if ("organization" in rData.data.isp) {
                        $(rRows[8]).find("td").html(rData.data.isp.organization);
                    }
                    if (("autonomous_system_number" in rData.data.isp) && ("autonomous_system_organization" in rData.data.isp)) {
                        $(rRows[9]).find("td").html("AS" + rData.data.isp.autonomous_system_number.toString() + " - " + rData.data.isp.autonomous_system_organization);
                    }
                    if (rData.data.type) {
                        $(rRows[10]).find("td").html(rData.data.type.toUpperCase());
                    }
                }
                if (("location" in rData.data) && ("time_zone" in rData.data.location)) {
                    $(rRows[12]).find("td").html(rData.data.location.time_zone);
                }
                if (("location" in rData.data) && ("time" in rData.data.location)) {
                    $(rRows[13]).find("td").html(rData.data.location.time);
                }
            }
        });
        $(".bs-whois-modal-center").modal("show");
    }
    // function headerStats() {
    //     rURL = "./api?action=header_stats";
    //     $.getJSON(rURL, function(data) {
    //         $("#header_connections").html($.number(data.total_connections, 0));
    //         $("#header_users").html($.number(data.total_users, 0));
    //         $("#header_network_up").html($.number(Math.floor(data.bytes_sent / 125000), 0));
    //         $("#header_network_down").html($.number(Math.floor(data.bytes_received / 125000), 0));
    //         $("#header_streams_up").html($.number(data.total_running_streams, 0));
    //         $("#header_streams_down").html($.number(data.offline_streams, 0));
    //         setTimeout(headerStats, 1000);
    //     }).fail(function() {
    //         setTimeout(headerStats, 1000);
    //     });
    // }
    function addCredits(rID) {
        $('.creditsModal').data('id', rID);
        $("#credits_reason").val("");
        $("#credits").val(0);
        $('.creditsModal').modal('show');
        $(".quick_search").select2("close");
        $("#topnav-search").removeClass("active");
        refreshTooltips();
    }
    function submitCredits() {
        var rID = $('.creditsModal').data('id');
        var rReason = $("#credits_reason").val();
        var rCredits = $("#credits").val();
        $.getJSON("./api?action=adjust_credits&id=" + encodeURIComponent(rID) + "&reason=" + encodeURIComponent(rReason) + "&credits=" + encodeURIComponent(rCredits), function(data) {
            if (data.result === true) {
                $.toast("Credits have been adjusted.");
                refreshTable();
            } else {
                $.toast("Credits could not be adjusted.");
            }
        });
        hideModal('.creditsModal');
    }
    function searchAPI(rType, rID, rAction, rConfirm = false) {
        if (rType == "stream") {
            if ((rAction == "purge") && (!rConfirm)) {
                new jBox("Confirm", {
                    confirmButton: "Kill",
                    cancelButton: "Cancel",
                    content: "Are you sure you want to kill all connections?",
                    confirm: function () {
                        searchAPI(rType, rID, rAction, true);
                    }
                }).open();
            } else {
                rConfirm = true;
            }
            if (rConfirm) {
                $.getJSON("./api?action=stream&sub=" + rAction + "&stream_id=" + rID + "&server_id=-1", function(data) {
                    if (data.result == true) {
                        if (rAction == "start") {
                            $.toast("Stream successfully started.");
                        } else if (rAction == "stop") {
                            $.toast("Stream successfully stopped.");
                        } else if (rAction == "restart") {
                            $.toast("Stream successfully restarted.");
                        } else if (rAction == "purge") {
                            $.toast("Connections have been killed.");
                        }
                        $(".bigdrop .select2-search__field").trigger("input");
                        window.rSearchTop = $(".bigdrop .select2-results__options").scrollTop();
                    } else {
                        $.toast("An error occured while processing your request.");
                    }
                }).fail(function() {
                    $.toast("An error occured while processing your request.");
                });
            }
        } else if (rType == "movie") {
            if ((rAction == "purge") && (!rConfirm)) {
                new jBox("Confirm", {
                    confirmButton: "Kill",
                    cancelButton: "Cancel",
                    content: "Are you sure you want to kill all connections?",
                    confirm: function () {
                        searchAPI(rType, rID, rAction, true);
                    }
                }).open();
            } else {
                rConfirm = true;
            }
            if (rConfirm) {
                $.getJSON("./api?action=movie&sub=" + rAction + "&stream_id=" + rID + "&server_id=-1", function(data) {
                    if (data.result == true) {
                        if (rAction == "start") {
                            $.toast("Movie encoding has started. It will take some time before this movie is available.");
                        } else if (rAction == "stop") {
                            $.toast("Movie encoding has been stopped.");
                            refreshTable();
                        } else if (rAction == "purge") {
                            $.toast("Connections have been killed.");
                        }
                        $(".bigdrop .select2-search__field").trigger("input");
                        window.rSearchTop = $(".bigdrop .select2-results__options").scrollTop();
                    } else {
                        $.toast("An error occured while processing your request.");
                    }
                }).fail(function() {
                    $.toast("An error occured while processing your request.");
                });
            }
        } else if (rType == "episode") {
            if ((rAction == "purge") && (!rConfirm)) {
                new jBox("Confirm", {
                    confirmButton: "Kill",
                    cancelButton: "Cancel",
                    content: "Are you sure you want to kill all connections?",
                    confirm: function () {
                        searchAPI(rType, rID, rAction, true);
                    }
                }).open();
            } else {
                rConfirm = true;
            }
            if (rConfirm) {
                $.getJSON("./api?action=episode&sub=" + rAction + "&stream_id=" + rID + "&server_id=-1", function(data) {
                    if (data.result == true) {
                        if (rAction == "start") {
                            $.toast("Episode encoding has started. It will take some time before this episode is available.");
                        } else if (rAction == "stop") {
                            $.toast("Episode encoding has been stopped.");
                        } else if (rAction == "purge") {
                            $.toast("Connections have been killed.");
                        }
                        $(".bigdrop .select2-search__field").trigger("input");
                        window.rSearchTop = $(".bigdrop .select2-results__options").scrollTop();
                    } else {
                        $.toast("An error occured while processing your request.");
                    }
                }).fail(function() {
                    $.toast("An error occured while processing your request.");
                });
            }
        } else if (rType == "user") {
            $.getJSON("./api?action=reg_user&sub=" + rAction + "&user_id=" + rID, function(data) {
                if (data.result === true) {
                    if (rAction == "enable") {
                        $.toast("User has been enabled.");
                    } else if (rAction == "disable") {
                        $.toast("User has been disabled.");
                    }
                    $(".bigdrop .select2-search__field").trigger("input");
                    window.rSearchTop = $(".bigdrop .select2-results__options").scrollTop();
                } else {
                    $.toast("An error occured while processing your request.");
                }
            }).fail(function() {
                $.toast("An error occured while processing your request.");
            });
        } else if (rType == "line") {
            if ((rAction == "kill") && (!rConfirm)) {
                new jBox("Confirm", {
                    confirmButton: "Kill",
                    cancelButton: "Cancel",
                    content: "Are you sure you want to kill all connections for this line?",
                    confirm: function () {
                        searchAPI(rType, rID, rAction, true);
                    }
                }).open();
            } else {
                rConfirm = true;
            }
            if (rConfirm) {
                $.getJSON("./api?action=line&sub=" + rAction + "&user_id=" + rID, function(data) {
                    if (data.result === true) {
                        if (rAction == "enable") {
                            $.toast("Line has been enabled.");
                        } else if (rAction == "disable") {
                            $.toast("Line has been disabled.");
                        } else if (rAction == "unban") {
                            $.toast("Line has been unbanned.");
                        } else if (rAction == "ban") {
                            $.toast("Line has been banned.");
                        } else if (rAction == "kill") {
                            $.toast("All connections for this line have been killed.");
                        }
                        $(".bigdrop .select2-search__field").trigger("input");
                        window.rSearchTop = $(".bigdrop .select2-results__options").scrollTop();
                    } else {
                        $.toast("An error occured while processing your request.");
                    }
                }).fail(function() {
                    $.toast("An error occured while processing your request.");
                });
            }
        }
    }
    function editModal(rEvent, rType, rID, rTitle) {
        if (rEvent) {
            rEvent.preventDefault();
        }
        eModal.iframe(rType + '?id=' + rID + '&modal=1', rTitle);
    }
    function closeEditModal(){
        $('.modal').modal('hide');
        if ($("#datatable-users").length) {
            $("#datatable-users").DataTable().ajax.reload(null, false);
        }
        if ($("#datatable-streampage").length) {
            $("#datatable-streampage").DataTable().ajax.reload(null, false);
        }
    }
    function initSearch() {
        $(".dropdown").unbind("click");
        $(".dropdown").click(function() {
            if ($(this).attr("id") == "search-mobile") {
                if ($("#topnav-search").hasClass("active")) {
                    $(".quick_search").select2("close");
                    $("#topnav-search").removeClass("active");
                } else {
                    $("#topnav-search").addClass("active");
                    $(".quick_search").select2("open");
                }
            } else {
                if ($("#topnav-search").hasClass("active")) {
                    $(".quick_search").select2("close");
                    $("#topnav-search").removeClass("active");
                }
            }
        });
        $(".quick_search").unbind("select2:opening");
        $(".quick_search").unbind("select2:closing");
        $(".quick_search").unbind("select2:selecting");
        $(".quick_search").unbind("select2:draw");
        $(".quick_search").select2({
            ajax: {
                url: './api',
                dataType: 'json',
                data: function (params) {
                    return {
                        search: params.term,
                        action: 'search'
                    };
                },
                processResults: function (data, params) {
                    return {
                        results: data.items
                    };
                },
                cache: true
            },
            minimumInputLength: 3,
            templateResult: function(data) { return data.html },
            escapeMarkup: function(m) { return m; },
            placeholder: 'Search...',
            dropdownCssClass: 'bigdrop'
        }).on("select2:opening", function(e) {
            if ($("#header_stats").is(":visible")) {
                var rMaxWidth = parseInt($(".app-search-box").position()["left"] - ($("#header_stats li:last").position()["left"] + $("#header_stats li:last").width()));
                if (rMaxWidth < 600) {
                    $("#header_stats").hide();
                }
                $(".app-search").width(600);
            }
            window.rSearchTop = 0;
        }).on("select2:closing", function(e) {
            $(".bigdrop .select2-results__options li").remove();
            $("#header_stats").show();
            $(".app-search").width(150);
            window.rSearchTop = 0;
        }).on("select2:selecting", function (e) {
            e.preventDefault();
            return false;
        }).on("select2:draw", function (e) {
            refreshTooltips();
            if (window.rSearchTop > 0) {
                $(".bigdrop .select2-results__options").scrollTop(window.rSearchTop);
                window.rSearchTop = 0;
            }
        });
        $(".app-search-box .select2-selection").addClass($(".app-search").data("theme")).addClass("header-search");
        $("#mod_fingerprint_type").unbind("change");
        $("#mod_fingerprint_type").change(function() {
            if ($(this).val() == 3) {
                $("#mod_custom_message_div").show();
            } else {
                $("#mod_custom_message_div").hide();
            }
        });
        $("#mod_font_size").inputFilter(function(value) { return /^\d*$/.test(value); });
        $("#mod_position_x").inputFilter(function(value) { return /^\d*$/.test(value); });
        $("#mod_position_y").inputFilter(function(value) { return /^\d*$/.test(value); });
    }
</script>
<script id="scripts">
    var resizeObserver = new ResizeObserver(entries => $(window).scroll());
    $(document).ready(function() {
        resizeObserver.observe(document.body)
        $("form").attr('autocomplete', 'off');
        $(document).keypress(function(event){
            if(event.which == 13 && event.target.nodeName != "TEXTAREA") return false;
        });
        $.fn.dataTable.ext.errMode = 'none';
        var elems = Array.prototype.slice.call(document.querySelectorAll('.js-switch'));
        elems.forEach(function(html) {
            var switchery = new Switchery(html, {'color': '#414d5f'});
            window.rSwitches[$(html).attr("id")] = switchery;
        });
        setTimeout(pingSession, 30000);
        headerStats();
        bindHref(); refreshTooltips();
        $(window).scroll(function(){
            if ($(this).scrollTop() > 200) {
                if ($(document).height() > $(window).height()) {
                    $('#scrollToBottom').fadeOut();
                }
                $('#scrollToTop').fadeIn();
            } else {
                $('#scrollToTop').fadeOut();
                if ($(document).height() > $(window).height()) {
                    $('#scrollToBottom').fadeIn();
                } else {
                    $('#scrollToBottom').hide();
                }
            }
        });
        $("#scrollToTop").unbind("click");
        $('#scrollToTop').click(function(){
            $('html, body').animate({scrollTop : 0}, 800);
            return false;
        });
        $("#scrollToBottom").unbind("click");
        $('#scrollToBottom').click(function(){
            $('html, body').animate({scrollTop : $(document).height()}, 800);
            return false;
        });
        $(window).scroll();
        $(".nextb").unbind("click");
        $(".nextb").click(function() {
            var rPos = 0; var rActive = null;
            $(".nav .nav-item").each(function() {
                if ($(this).find(".nav-link").hasClass("active")) {
                    rActive = rPos;
                }
                if (rActive !== null && rPos > rActive && !$(this).find("a").hasClass("disabled") && $(this).is(":visible")) {
                    $(this).find(".nav-link").trigger("click");
                    return false;
                }
                rPos += 1;
            });
        });
        $(".prevb").unbind("click");
        $(".prevb").click(function() {
            var rPos = 0; var rActive = null;
            $($(".nav .nav-item").get().reverse()).each(function() {
                if ($(this).find(".nav-link").hasClass("active")) {
                    rActive = rPos;
                }
                if (rActive !== null && rPos > rActive && !$(this).find("a").hasClass("disabled") && $(this).is(":visible")) {
                    $(this).find(".nav-link").trigger("click");
                    return false;
                }
                rPos += 1;
            });
        });
        (function($) {
            $.fn.inputFilter = function(inputFilter) {
                return this.on("input keydown keyup mousedown mouseup select contextmenu drop", function() {
                    if (inputFilter(this.value)) {
                        this.oldValue = this.value;
                        this.oldSelectionStart = this.selectionStart;
                        this.oldSelectionEnd = this.selectionEnd;
                    } else if (this.hasOwnProperty("oldValue")) {
                        this.value = this.oldValue;
                        this.setSelectionRange(this.oldSelectionStart, this.oldSelectionEnd);
                    }
                });
            };
        }(jQuery));
        $(".navigation-menu li").mouseenter(function() {
            $(this).find(".submenu").show();
        });
        delParam("status");
        $(window).on("popstate", function () {
            if (window.rRealURL) {
                if (window.rRealURL.split("/").reverse()[0].split("?")[0].split(".")[0] != window.location.href.split("/").reverse()[0].split("?")[0].split(".")[0]) {
                    navigate(window.location.href.split("/").reverse()[0]);
                }
            }
        });
        $(document).keydown(function (e) {
            if (e.keyCode == 16) {
                window.rShiftHeld = true;
            }
        });
        $(document).keyup(function (e) {
            if (e.keyCode == 16) {
                window.rShiftHeld = false;
            }
        });
        document.onselectstart = function() {
            if (window.rShiftHeld) {
                return false;
            }
        }
    });
    var rClearing = false;
    var rSelected = [];

    function api(rID, rType, rConfirm=false) {
        if ((window.rSelected) && (window.rSelected.length > 0)) {
            $.toast("Individual actions disabled in multi-select mode.");
            return;
        }
        if ((rType == "delete") && (!rConfirm)) {
            new jBox("Confirm", {
                confirmButton: "Delete",
                cancelButton: "Cancel",
                content: "Are you sure you want to delete this user?",
                confirm: function () {
                    api(rID, rType, true);
                }
            }).open();
        } else {
            rConfirm = true;
        }
        if (rConfirm) {
            $.getJSON("./api?action=reg_user&sub=" + rType + "&user_id=" + rID, function(data) {
                if (data.result === true) {
                    if (rType == "delete") {
                        $.toast("User has been deleted.");
                    } else if (rType == "enable") {
                        $.toast("User has been enabled.");
                    } else if (rType == "disable") {
                        $.toast("User has been disabled.");
                    }
                    $("#datatable-users").DataTable().ajax.reload(null, false);
                } else {
                    $.toast("An error occured while processing your request.");
                }
            });
        }
    }
    function multiAPI(rType, rConfirm=false) {
        if (rType == "clear") {
            if ("#header_stats") {
                $("#header_stats").show();
            }
            window.rSelected = [];
            $(".multiselect").hide();
            $("#datatable-users tr").removeClass('selectedfilter').removeClass('ui-selected').removeClass("selected");
            return;
        }
        if ((rType == "delete") && (!rConfirm)) {
            new jBox("Confirm", {
                confirmButton: "Delete",
                cancelButton: "Cancel",
                content: "Are you sure you want to delete these users?",
                confirm: function () {
                    multiAPI(rType, true);
                }
            }).open();
        } else {
            rConfirm = true;
        }
        if (rConfirm) {
            $.getJSON("./api?action=multi&type=user&sub=" + rType + "&ids=" + JSON.stringify(window.rSelected), function(data) {
                if (data.result == true) {
                    if (rType == "enable") {
                        $.toast("Users have been enabled.");
                    } else if (rType == "disable") {
                        $.toast("Users have been disabled.");
                    } else if (rType == "delete") {
                        $.toast("Users have been deleted.");
                    }
                    $("#datatable-users").DataTable().ajax.reload(null, false);
                } else {
                    $.toast("An error occured while processing your request.");
                }
            }).fail(function() {
                $.toast("An error occured while processing your request.");
            });
            multiAPI("clear");
        }
    }
    function getFilter() {
        return $("#reg_filter").val();
    }
    function getReseller() {
        return $("#reg_reseller").val();
    }
    function clearFilters() {
        window.rClearing = true;
        $("#reg_search").val("").trigger('change');
        $('#reg_filter').val("").trigger('change');
        $('#reg_reseller').val("").trigger('change');
        $('#reg_show_entries').val("50").trigger('change');
        window.rClearing = false;
        $('#datatable-users').DataTable().search($("#reg_search").val());
        $('#datatable-users').DataTable().page.len($('#reg_show_entries').val());
        $("#datatable-users").DataTable().page(0).draw('page');
        $("#datatable-users").DataTable().ajax.reload( null, false );
        delParams(["search", "filter", "owner", "page", "entries"]);
        checkClear();
    }
    function checkClear() {
        if (!hasParams(["search", "filter", "owner"])) {
            $("#clearFilters").prop("disabled", true);
        } else {
            $("#clearFilters").prop("disabled", false);
        }
    }
    function refreshTable() {
        $("#datatable-users").DataTable().ajax.reload( null, false );
    }
    function clearOwner() {
        $('#reg_reseller').val("").trigger('change');
    }
    var rSearch;
    $(document).ready(function() {
        $('select').select2({width: '100%'});
        $('#reg_reseller').select2({
            ajax: {
                url: './api',
                dataType: 'json',
                data: function (params) {
                    return {
                        search: params.term,
                        action: 'reguserlist',
                        page: params.page
                    };
                },
                processResults: function (data, params) {
                    params.page = params.page || 1;
                    return {
                        results: data.items,
                        pagination: {
                            more: (params.page * 100) < data.total_count
                        }
                    };
                },
                cache: true,
                width: "100%"
            },
            placeholder: 'Search for an owner...'
        });
        var rPage = getParam("page");
        if (!rPage) { rPage = 1; }
        var rEntries = getParam("entries");
        if (!rEntries) { rEntries = 50; }
        var rTable = $("#datatable-users").DataTable({
            language: {
                paginate: {
                    previous: "<i class='mdi mdi-chevron-left'>",
                    next: "<i class='mdi mdi-chevron-right'>"
                }
            },
            drawCallback: function() {
                bindHref(); refreshTooltips();
                if ($("#datatable-users").DataTable().page.info().page > 0) {
                    setParam("page", $("#datatable-users").DataTable().page.info().page+1);
                } else {
                    delParam("page");
                }
                var rOrder = $("#datatable-users").DataTable().order()[0];
                setParam("order", rOrder[0]); setParam("dir", rOrder[1]);
                // Multi Actions
                multiAPI("clear");
                $("#datatable-users tr").click(function() {
                    if (window.rShiftHeld) {
                        if ($(this).hasClass('selectedfilter')) {
                            $(this).removeClass('selectedfilter').removeClass('ui-selected').removeClass("selected");
                            window.rSelected.splice($.inArray($(this).find("td:eq(0)").text(), window.rSelected), 1);
                        } else {
                            $(this).addClass('selectedfilter').addClass('ui-selected').addClass("selected");
                            window.rSelected.push($(this).find("td:eq(0)").text());
                        }
                    }
                    $("#multi_users_selected").html(window.rSelected.length + " users");
                    if (window.rSelected.length > 0) {
                        if ("#header_stats") {
                            $("#header_stats").hide();
                        }
                        $("#multiselect_users").show();
                    } else {
                        if ("#header_stats") {
                            $("#header_stats").show();
                        }
                        $("#multiselect_users").hide();
                    }
                });
            },
            responsive: false,
            processing: true,
            serverSide: true,
            searchDelay: 250,
            ajax: {
                url: "./table",
                "data": function(d) {
                    d.id = "reg_users",
                        d.filter = getFilter(),
                        d.reseller = getReseller()
                }
            },
            columnDefs: [
                {"className": "dt-center", "targets": [0,3,4,5,6,7,8,9,10,11,12]},
                {"orderable": false, "targets": [7,8,9,10,12]}
            ],
            order: [[ 0, "desc" ]],
            pageLength: parseInt(rEntries),
            lengthMenu: [10, 25, 50, 250, 500, 1000],
            displayStart: (parseInt(rPage)-1) * parseInt(rEntries)
        });
        function doSearch(rValue) {
            clearTimeout(window.rSearch); window.rSearch = setTimeout(function(){ rTable.search(rValue).draw(); }, 500);
        }
        $("#datatable-users").css("width", "100%");
        $('#reg_search').keyup(function(){
            if (!window.rClearing) {
                delParam("page");
                rTable.page(0);
                if ($("#reg_search").val()) {
                    setParam("search", $("#reg_search").val());
                } else {
                    delParam("search");
                }
                checkClear();
                doSearch($(this).val());
            }
        });
        $('#reg_show_entries').change(function(){
            if (!window.rClearing) {
                delParam("page");
                rTable.page(0);
                if ($("#reg_show_entries").val()) {
                    setParam("entries", $("#reg_show_entries").val());
                } else {
                    delParam("entries");
                }
                checkClear();
                rTable.page.len($(this).val()).draw();
            }
        });
        $('#reg_filter').change(function(){
            if (!window.rClearing) {
                delParam("page");
                rTable.page(0);
                if ($("#reg_filter").val()) {
                    setParam("filter", $("#reg_filter").val());
                } else {
                    delParam("filter");
                }
                checkClear();
                rTable.ajax.reload( null, false );
            }
        });
        $('#reg_reseller').change(function(){
            if (!window.rClearing) {
                delParam("page");
                rTable.page(0);
                if ($("#reg_reseller").val()) {
                    setParam("owner", $("#reg_reseller").val());
                } else {
                    delParam("owner");
                }
                checkClear();
                $("#datatable-users").DataTable().ajax.reload( null, false );
            }
        });
        if ($('#reg_search').val()) {
            rTable.search($('#reg_search').val()).draw();
        }
        $("#btn-export-csv").click(function() {
            $.toast("Generating CSV report...");
            window.location.href = "api?action=report&params=" + encodeURIComponent(JSON.stringify($("#datatable-users").DataTable().ajax.params()));
        });
        checkClear();
    });

    $(document).ready(function() {
        initSearch();
    });
</script>
<script src="assets/js/listings.js"></script>

</body>
</html>